<!DOCTYPE html><html lang="en"><head><title>YUI Uploader and IE7 Flash Bugs</title><link rel="canonical" href="https://blog.davemo.com/posts/2009-03-24-yui-uploader-and-ie7-flash-bugs.html"><link rel="stylesheet" type="text/css" media="all" href="/css/app.css"><link rel="alternate" type="application/rss+xml" title="David Mosher | Canadian Software Developer, Designer, Musician, and Artist" href="/index.xml"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="manifest" href="/site.webmanifest"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><meta name="msapplication-TileColor" content="#00aba9"><meta name="theme-color" content="#ffffff"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="description" property="og:description" content="Bugs with the YUI Loader and Internet Explorer 7."><meta name="theme-color" content="#bf5600"><meta name="author" content="David Mosher"><meta name="date" content="2009-03-24"><meta name="article:published_time" content="2009-03-24"><meta name="article:modified_time" content="2009-03-24"><meta name="twitter:title" content="YUI Uploader and IE7 Flash Bugs"><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@dmosher"><meta name="twitter:creator" content="@dmosher"><meta name="twitter:description" content="Bugs with the YUI Loader and Internet Explorer 7."></head><body><div id="wrap"><div id="layout"><header><a href="/">blog.davemo.com</a><span class="description">thoughts on software, music, art, and meaning.</span></header><nav><a id="logo" href="/"></a><ul><li><a href="/archive.html">archive</a></li><li><a href="/">homepage</a></li><li><a href="/screencasts.html">screencasts</a></li><li><a href="/talks.html">talks</a></li></ul><div class="middle" id="older-newer"><div class="newer"><a href="/posts/2009-06-17-using-the-cloud-as-a-blog.html">newer</a></div><div class="older"><a href="/posts/2009-03-13-javascript-dependency-management-and-yui-loader-quirks.html">older</a></div></div></nav><article id="post"><h1><a href="/posts/2009-03-24-yui-uploader-and-ie7-flash-bugs.html" title="Permanent link to ‘YUI Uploader and IE7 Flash Bugs’">YUI Uploader and IE7 Flash Bugs</a></h1><time datetime="2009-03-24">March 24th, 2009</time><aside class="tldr">
The YUI Uploader is handy, but it has a number of quirks in IE7.
</aside>

<p>We covered a lot of ground on the <a href="https://www.myfrontsteps.com">MyFrontSteps</a> project this week. We managed to migrate our Photo Management / Uploading solution on Homebook from <a href="https://swfupload.org/">SWFUpload</a> and a lot of hacked together <a href="https://www.jquery.com">jQuery</a> to a more elegant solution (albeit one that could still use some refactoring - but what code can’t use refactoring really).</p>
<p>We decided to use the “still-in-beta” <a href="https://developer.yahoo.com/yui/uploader/">YUI Uploader</a> coupled with some custom jQuery. The implementation seems much more cohesive than our previous solution but there were a few gotchas we rant into when trying to get things working properly in IE7.</p>
<h2 id="yui-uploader">YUI Uploader</h2>
<p>I know this component is still in beta support from Yahoo, but I had given it a
very brief try in our supported browser baseline (currently FF2+, Safari3+,
IE7+) and it seemed to work really well. All of the YUI stuff we’re using works
really well and the graded browser support and testing the YUI team puts behind
their work makes implementation that much more reliable. That being said, no
piece of software is perfect and we ran into a pretty frustrating bug
implementing the YUI Uploader in a specific area of the application.</p>
<p class="center gray-box">
  <img alt="A flyover context menu with an embedded YUI Uploader." src="/img/yui-uploader-and-ie7-flash-bugs/picture-24.png" />
</p>

<p>We have a number of context menus in Homebook that appear to the user on mouseover. This particular thumbnail represents the default image for a users Home, and clicking it prompts the user with a file dialog to select a new photo which is then uploaded via the YUI Uploader. When instantiated, the uploader inserts a transparent Flash object using the <a href="https://blog.deconcept.com/swfobject/">SWFObject</a> plugin into the markup in the container specified. In our case we had the following markup:</p>
<pre><code class="hljs language-xml">ul class=&#x27;mfs-context-menu invisible&#x27; id=&#x27;default-image-menu&#x27;
   li
      a
        span class=&#x27;uploader&#x27; id=&#x27;upload-profile-picture&#x27; /span
        &#x27;Change Profile Picture&#x27;
     /a
  /li
/ul
</code></pre>
<p>We use a class of invisible to set the css property <code>display:none;</code> on the <code>ul</code> so it’s hidden by default when the page loads. When the page loads and the script triggers, the uploader sits nicely in the span tag directly above the link in the li tag. The user then clicks on the transparent flash object and the upload can start. Now, this approach works fine in every browser <em>EXCEPT</em> IE7.</p>
<p>For some reason when the uploader is instantiated in IE7 if it becomes hidden and then shown again at any point the YUI Uploader loses all binding to the functions that trigger submission to the server side url. I tried doing some searching to see if this was documented anywhere and came up empty everywhere I looked.</p>
<aside>My best guess is that the IE7 security model doesn't like the fact that an 'embed' tag with the Flash object is being manipulated from JavaScript and decided to turn off something that disables the uploader from completing an upload. The file dialog will still popup, and the embedded Flash remains in the DOM but the uploader doesn't trigger sending of the files to the server.</aside>

<p>It took us a while to figure out what was going on, and the only way we tracked it down was by a process of elimination commenting out lines of code in the uploader instantiation script until we discovered it was our context menu show/hide trigger that made the uploader behave this way.</p>
<p>So, the solution in our case was to move the uploader <code>span</code> tag outside of the <code>li</code> but still inside the thumbnail container, give it a fixed width and height directly above the image (like a transparent rectangle) and bind mouseover/mouseout events to it that triggered show/hide of the <code>li</code> element with the <code>a</code> inside:</p>
<pre><code class="hljs language-xml">ul class=&#x27;mfs-context-menu invisible&#x27; id=&#x27;default-image-menu&#x27;
  span class=&#x27;uploader&#x27; id=&#x27;upload-profile-picture&#x27; /span
    li a &#x27;Change Profile Picture&#x27; /a /li
/ul
</code></pre>
<p>This way the flash element never gets hidden, and IE7 doesn’t do anything funky to it so the uploader remains operational.</p>
</article><div id="sidebar"><div class="profile_image"><img src="/img/site/davemo.upscaled.png" alt="David A. Mosher"></div><div class="icons"><a class="icon github" href="https://github.com/davemo" title="davemo on github"></a><a class="icon linkedin" href="https://linkedin.com/in/dmosher" title="dmosher on linkedin"></a><a class="icon twitter" href="https://twitter.com/dmosher" title="dmosher on twitter"></a><a class="icon youtube" href="https://youtube.com/davidmosher" title="davidmosher on youtube"></a></div><p style="text-align: right;">David Mosher is a Canadian Software Developer, Designer, Musician, and Artist.</p></div><footer>&copy; 2007–2021 David Mosher</footer></div></div><script type="text/javascript" async src="/js/app.js"></script></body></html>